{-# OPTIONS --safe #-}
module FreeGpd.Base where

open import Prelude

private variable
  â„“v â„“e â„“ â„“â€² : Level
  V : ğ’° â„“v
  A : ğ’° â„“
  G : V â†’ V â†’ ğ’° â„“e
  H : A â†’ A â†’ ğ’° â„“â€²

-- free 1-groupoid generated by a graph
-- aka geometric realization

data FreeGpd (G : V â†’ V â†’ ğ’° â„“e) : ğ’° (level-of-type V âŠ” â„“e) where
  vtx   : V â†’ FreeGpd G
  edge  : {x y : V} â†’ G x y â†’ vtx x ï¼ vtx y
  trunc : is-groupoid (FreeGpd G)

elim : {C : FreeGpd G â†’ ğ’° â„“}
     â†’ is-of-hlevel-dep 2 C
     â†’ (vc : (v : V) â†’ C (vtx v))
     â†’ ({x y : V} â†’ (e : G x y) â†’ ï¼œ vc x ï¼ (Î» i â†’ C (edge {x = x} {y = y} e i)) ï¼¼ vc y ï¼)
     â†’ (fg : FreeGpd G) â†’ C fg
elim gp vc ec (vtx v)                   = vc v
elim gp vc ec (edge e i)                = ec e i
elim gp vc ec (trunc p q u v x y i j k) =
  gp (go p) (go q)
     (Î» h â†’ go (u h))
     (Î» h â†’ go (v h))
     (Î» h k â†’ go (x h k))
     (Î» h k â†’ go (y h k))
     (trunc p q u v x y)
     i j k
  where go = elim gp vc ec

elim-set : {C : FreeGpd G â†’ ğ’° â„“}
         â†’ (âˆ€ fg â†’ is-set (C fg))
         â†’ (vc : (v : V) â†’ C (vtx v))
         â†’ ({x y : V} â†’ (e : G x y) â†’ ï¼œ vc x ï¼ (Î» i â†’ C (edge {x = x} {y = y} e i)) ï¼¼ vc y ï¼)
         â†’ (fg : FreeGpd G) â†’ C fg
elim-set sc =
  elim Î» {aâ‚€} {aâ‚} â†’
      is-of-hlevelâ†’is-of-hlevel-dep 2
            (Î» q â†’ is-of-hlevel-suc 2 (sc q))
          {aâ‚€} {aâ‚}

elim-prop : {C : FreeGpd G â†’ ğ’° â„“}
          â†’ (âˆ€ fg â†’ is-prop (C fg))
          â†’ (vc : (v : V) â†’ C (vtx v))
          â†’ (fg : FreeGpd G) â†’ C fg
elim-prop pc vc =
  elim
    (    Î» {aâ‚€} {aâ‚} â†’
      is-of-hlevelâ†’is-of-hlevel-dep 2
            (Î» q â†’ is-of-hlevel-+ 1 2 (pc q))
          {aâ‚€} {aâ‚})
    vc
    (Î» e â†’ to-pathá´¾ (pc (edge e i1) _ (vc _)))

rec : is-groupoid A
    â†’ (va : V â†’ A)
    â†’ ({x y : V} â†’ G x y â†’ va x ï¼ va y)
    â†’ FreeGpd G â†’ A
rec gp va vc (vtx v)                   = va v
rec gp va vc (edge e i)                = vc e i
rec gp va vc (trunc p q u v x y i j k) =
  gp (go p) (go q)
     (Î» h â†’ go (u h))
     (Î» h â†’ go (v h))
     (Î» h k â†’ go (x h k))
     (Î» h k â†’ go (y h k))
     i j k
  where go = rec gp va vc

-- mapping a graph homomorphism
map-hom : (f : V â†’ A)
        â†’ ({x y : V} â†’ G x y â†’ H (f x) (f y))
        â†’ FreeGpd G â†’ FreeGpd H
map-hom f g = rec trunc (vtx âˆ˜ f) (edge âˆ˜ g)
